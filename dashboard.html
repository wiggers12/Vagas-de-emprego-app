<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - App do Atleta</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { background:#111; color:#fff; font-family:Montserrat,sans-serif; padding:20px; }
    h1 { color:#FFD700; }
    .charts { display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-top:20px; }
    canvas { background:#1e1e1e; padding:15px; border-radius:12px; }
    table { width:100%; margin-top:30px; border-collapse:collapse; }
    th,td { padding:10px; border:1px solid #333; }
    th { background:#222; color:#FFD700; }
  </style>
</head>
<body>
  <h1>üèÜ Dashboard Unificado - Atletas</h1>

  <div class="charts">
    <canvas id="sexoChart"></canvas>
    <canvas id="graduacaoChart"></canvas>
    <canvas id="analiseChart"></canvas>
    <canvas id="posicoesChart"></canvas>
    <canvas id="nutricaoChart"></canvas>
  </div>

  <h2>üìã Dados Consolidados</h2>
  <table>
    <thead>
      <tr>
        <th>Nome</th><th>Sexo</th><th>Gradua√ß√£o</th><th>Tempo de treino</th>
        <th>Performance</th><th>Posi√ß√µes dominadas</th><th>Dieta (calorias)</th>
      </tr>
    </thead>
    <tbody id="listaAtletas"><tr><td colspan="7">Carregando...</td></tr></tbody>
  </table>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyC1WaaBD9XXRoMGgiKRU_qTLcQ5CdNHQKs",
      authDomain: "vagas-de-emprego-app.firebaseapp.com",
      projectId: "vagas-de-emprego-app",
      storageBucket: "vagas-de-emprego-app.appspot.com",
      messagingSenderId: "301719945007",
      appId: "1:301719945007:web:e2b5141d1fc941bd11ebda"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Inicializa gr√°ficos
    const sexoChart = new Chart(document.getElementById("sexoChart"), {
      type:"doughnut", data:{ labels:["Masculino","Feminino"], datasets:[{ data:[0,0], backgroundColor:["#3498db","#e91e63"] }] }
    });
    const graduacaoChart = new Chart(document.getElementById("graduacaoChart"), {
      type:"bar", data:{ labels:["Branca","Azul","Roxa","Marrom","Preta"], datasets:[{ label:"Qtd", data:[0,0,0,0,0], backgroundColor:"#FFD700" }] }
    });
    const analiseChart = new Chart(document.getElementById("analiseChart"), {
      type:"line", data:{ labels:[], datasets:[{ label:"Tempo de treino (anos)", data:[], borderColor:"#00ff95", fill:false }] }
    });
    const posicoesChart = new Chart(document.getElementById("posicoesChart"), {
      type:"bar", data:{ labels:["Dominadas","Tentadas"], datasets:[{ data:[0,0], backgroundColor:["#2ecc71","#e74c3c"] }] }
    });
    const nutricaoChart = new Chart(document.getElementById("nutricaoChart"), {
      type:"pie", data:{ labels:["Prote√≠na","Carboidrato","Gordura"], datasets:[{ data:[0,0,0], backgroundColor:["#9b59b6","#f1c40f","#e67e22"] }] }
    });

    // Consolidar dados de todas cole√ß√µes
    let atletas={}, analises={}, posicoes={}, nutricao={};

    function atualizarTabela() {
      const tbody = document.getElementById("listaAtletas");
      tbody.innerHTML = "";
      Object.keys(atletas).forEach(uid=>{
        const a = atletas[uid]||{};
        const an = analises[uid]||{};
        const p = posicoes[uid]||{};
        const n = nutricao[uid]||{};
        tbody.innerHTML += `
          <tr>
            <td>${a.nome||""}</td>
            <td>${a.sexo||""}</td>
            <td>${a.graduacao||""}</td>
            <td>${an.tempo||"-"}</td>
            <td>${an.performance||"-"}</td>
            <td>${p.dominadas||0}</td>
            <td>${n.calorias||0}</td>
          </tr>`;
      });
    }

    // Escutar cole√ß√µes
    onSnapshot(collection(db,"atletas"), snap=>{
      atletas={}; let sexoCount={Masculino:0,Feminino:0}, gradCount={Branca:0,Azul:0,Roxa:0,Marrom:0,Preta:0};
      snap.forEach(d=>{ atletas[d.id]=d.data(); const a=d.data(); if(sexoCount[a.sexo]!==undefined) sexoCount[a.sexo]++; if(gradCount[a.graduacao]!==undefined) gradCount[a.graduacao]++; });
      sexoChart.data.datasets[0].data=[sexoCount.Masculino,sexoCount.Feminino]; sexoChart.update();
      graduacaoChart.data.datasets[0].data=Object.values(gradCount); graduacaoChart.update();
      atualizarTabela();
    });

    onSnapshot(collection(db,"analises"), snap=>{
      analises={}; let labels=[], tempos=[];
      snap.forEach(d=>{ analises[d.id]=d.data(); labels.push(d.data().nome||d.id); tempos.push(d.data().tempo||0); });
      analiseChart.data.labels=labels; analiseChart.data.datasets[0].data=tempos; analiseChart.update();
      atualizarTabela();
    });

    onSnapshot(collection(db,"posicoes"), snap=>{
      posicoes={}; let dominadas=0,tentadas=0;
      snap.forEach(d=>{ posicoes[d.id]=d.data(); dominadas+=d.data().dominadas||0; tentadas+=d.data().tentadas||0; });
      posicoesChart.data.datasets[0].data=[dominadas,tentadas]; posicoesChart.update();
      atualizarTabela();
    });

    onSnapshot(collection(db,"nutricao"), snap=>{
      nutricao={}; let prot=0,carb=0,gord=0;
      snap.forEach(d=>{ nutricao[d.id]=d.data(); prot+=d.data().proteina||0; carb+=d.data().carbo||0; gord+=d.data().gordura||0; });
      nutricaoChart.data.datasets[0].data=[prot,carb,gord]; nutricaoChart.update();
      atualizarTabela();
    });
  </script>
</body>
</html>